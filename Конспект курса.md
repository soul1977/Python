# Конспект курса "Python для сетевых инженеров"

## Подготовка к работе

### Полезные ссылки

[Сайт обучения](https://pyneng.github.io/)
[Книга Python для сетевых инженеров](https://pyneng.github.io/docs/pyneng-book/)
[Книга про Git](https://git-scm.com/book/ru/v2)
[Удобный сайт по модулям питон](http://pymotw.com)
[Официальный сайт Python](https://www.python.org/)
Книга по Python - "Python trick the book"

### VmWare

Для VmWare player нет штатного средства задать статический адрес для виртуальной машины.
(В Pro версии есть Vm Network editor)

[Правим файлы конфигурации:](https://medium.com/shehuawwal/how-to-assign-a-static-ip-address-to-a-vmware-workstation-vm-de7773f9ef19)

C:\ProgramData\VMware\vmnetdhcp.conf
Добавляем в конец файла

```ini
#Python
host VMnet8 {
    hardware ethernet 00:0C:29:D6:D1:F5;
    fixed-address 192.168.8.132;
}
```

Mac-адрес смотреть в виртуалке или в меню **Vmware Workstation / Player, Settings > Network Adapter > Advanced**

Перезапускаем службу и перестартовывает виртуалку

```cmd
net stop vmnetdhcp
net start vmnetdhcp
```

### Pip

Pip - это система управления пакетами. В зависимости от того, как установлен и настроен Python в системе, может потребоваться использовать pip3 вместо pip.
`pip --version`

#### Установка модулей

```bash
pip install tabulate
pip uninstall tabulate
pip3 install --upgrade tabulate

python3.7 -m pip install tabulate
```

#### Виртуальные окружения

В Python есть несколько вариантов для создания виртуальных окружений.
Использовать можно любой из них. Для начала можно использовать virtualenvwrapper

`sudo pip3.7 install virtualenvwrapper`

После установки, в файле `.bashrc`, находящимся в домашней папке текущего пользователя,
нужно добавить несколько строк:

```bash
export VIRTUALENVWRAPPER_PYTHON=/usr/local/bin/python3.7
export WORKON_HOME=~/venv
. /usr/local/bin/virtualenvwrapper.sh
```

Перезапуск командного интерпретатора:
`exec bash`

#### Работа с виртуальными окружениями

`mkvirtualenv --python=/usr/local/bin/python3.7 pyneng` - cоздание нового
`workon pyneng` - переход в созданное виртуальное окружение
`deactivate` - выход из виртуального окружения
`rmvirtualenv test` - удаление виртуального окружения
`lssitepackages` - какие пакеты установлены в виртуальном окружении

### Git

Дополнительные ресурсы, которые позволят глубже познакомиться с Git:

[GitHowTo](https://githowto.com/ru) - интерактивный howto на русском
[Pro Git book](https://git-scm.com/book/en/v2/) - Минимально необходимые знания для работы с Git и GitHub. Книга на русском

#### Установка Git

Можно установить Git локально и запустить web-интерфейс.
Например, GitLab. Вариантов много.

apt install git

#### Настройка Git

Для начала работы с Git, необходимо указать имя и e-mail пользователя, которые будут использоваться для синхронизации локального репозитория с репозиторием на GitHub:

```bash
git config --global user.name "username"
git config --global user.email "username.user@example.com"
```

global - используется для всех проетов
Посмотреть настройки Git можно таким образом:

```bash
git config --list
```

Файл исключений (эти файлы не отслеживаются Git)

```bash
.gitignore
    *.un~ (имя файла)
    .ssh (имя каталога)
```

Настройка отображения кириллических символов

```bash
git config --global core.quotepath false
```

#### Подключение к своему репозиторию по SSH

```bash
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/github_rsa
```

Проверка:

```bash
ssh -T git@github.com
Hi username! You've successfully authenticated, but GitHub does not provide shell access.
```

#### Команды Git

`git help команда` - help по команде
`git init` - инициализация репозитария (создается каталог .git, не забыть создать и перейти в каталог)
`git remote -v` - отображение свойств репозитария на удаленном сервере
`Ctrl-R` - вход в режим Git, когда он ищет вводимые символы в истории команд
`git checkout -- file` - откатить изменения в файле

* клонирование репозитария

`git clone https://github.com/natenka/pyneng-examples-exercises`

* работа
`git status`
`git pull` - обновление локального репозитория
`git add .` - добавляем в stage все файлы (рекурсивно вниз от текущего репозитория)
`git add r[1-3].txt`
`git commit -a` - add + commit
`git reset HEAD имя_файла` - убрать файл из stage area
`git rm -cached имя_файла_или_каталога` - убрать из репозитория (файл на диске остается)
`git commit -m "комментарий"` - коммитим измененния
`git push origin master` - загружаем в репозитарий изменения

* просмотр
`git diff` - показывает, какие изменения были внесены с момента последнего коммита
`git diff --cached` - diff в staged area
`git diff --staged` - отличия между staging и последним коммитом
`git log -p origin/master..` – она покажет, какие изменения вы собираетесь добавлять в свой репозиторий на GitHub
`git log -p -1` - какие именно изменения были внесены за 1 коммит
`git log -p ..origin/master` - какие изменения были выполнены с момента
последней синхронизации

#### Отображение статуса репозитория в приглашении

```bash
cd ~
git clone https://github.com/magicmonty/bash-git-prompt.git .bash-git-prompt --depth=1
```

А затем добавить в конец файла .bashrc такие строки:

```bash
GIT_PROMPT_ONLY_IN_REPO=1
source ~/.bash-git-prompt/gitprompt.sh
```

#### Github

Чтобы сдать сделанные задания, нужно в проделать ряд манипуляций в интерфейсе GitHub или использовать скрипт
см. раздел инструменты на сайте <https://pyneng.github.io/>

Работа с проверенными заданиями
https://pyneng.github.io/docs/checked-tasks-git/

### Visual Studio

Установим дополнения (Extensions)

* **Markdown extension pack** - появляется возможность просмотра "на лету"
* **Git history** - просмотр изменений в Git

#### Подключение к удаленному хосту

[Инструкция - Remote Development using SSH](https://code.visualstudio.com/docs/remote/ssh)
[Extension](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack)

### Windows

[Начало работы с Python в Windows для начинающих](https://docs.microsoft.com/ru-ru/windows/python/beginners)

[Python 3.7.6](https://www.python.org/downloads/release/python-376/)

[Виртуальное окружение в Python на Windows](https://calcsbox.com/post/virtualnoe-okruzenie-v-python-na-windows.html)

#### Установка и настройка Git

Инструкции:
[Установка Git на Windows](https://git-scm.com/book/ru/v2/%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-Git)
[Downloading Git](https://git-scm.com/download/win)
[GitHub Desktop](https://desktop.github.com/)
[Подключение к Git по SSH в Windows](https://habr.com/ru/post/266667/)

#### Настройка Python

```cmd
pip install virtualenvwrapper-win
mkvirtualenv pyneng
workon pyneng
pip install mu-editor
```

Python - интерпретируемый язык (можно выполнять построчно)
REPL = интерпритатор
**ipyton** - удобный интерпритатор
**jupiter** - интерпритатор, работающий в браузере

### Подготовка

Модули ставятся через pip

```cmd
pip --version
```

`Python2.7 -m pip install ххх` - установка модуля под версию 2.7

Лучше работать через виртуальные окружения

`pip list` - список пакетов

модули лучше обновлять после тестиорвания в новом вирт.окружунии

### Виртуальные окружения

нужно использовать только 1 способ работы с вирт.окр
рекомендуется использовать `virtualenvwrapper`

* команды
`which python3.7` - путь в системе
`mkvirtualenv --python="путь к python"` создание вирт.окружения (рекомендуется в имени указать версию питон)
`rmvirtualenv имя` - удалить окружение
`workon [tab]` - просмотр всех окружений
`workon имя` - переход в окружение
`deactivate` - выход

* как удобно проверять переход на новую версию пакета
`cpvirtualenv имя` - скопировать окружение
`обновить нужные пакеты`

* как удобно проверять переход на новую версию питон
`pip freeze` - список модулей в вирт окруж
`создать новое окружение`
`создать файл requirements`
`pip install -r ???` - устанавливает все модули,указанные в файле requirements

## Python

### Синтаксис Python

**.py** - расширение для скриптов питона
**pep8** - документ, описывающий правила написания кода

**Отступы** - это имеют значения, они отделяют блоки кода
Рекомендуется в качестве отступа использовать 4 пробела (нужно настроить tab=4 пробела)

* Комментарии
`# ...` - однострочный

```python
"""
многострочный
комментарий
"""
```

* ipython - удобный интерпретатор
`%` - специфично для ipython
`%history` - история
    `pg-up, pg-down`
    `ctrl-r` - поиск по истории
`ctrl-a, b, u` работают
`функция?` - помощь по функции
`dir()` - список переменных

### Типы данных

#### Строки

**неизменяемый** упорядоченный тип данных => можно обращаться по индексу `строка[0]`
заключается в одинарные или двойные кавычки
рекомендуется выбрать один вариант (или ', или ")

`\n` - перевод строки (зависит от ОС, может быть `\r\n`)
`\r` - возврат каретки в начало строки

* Срезы

`строка[1:5:2]` - 

* Методы

```python
test = "тестовая строка"
test.метод()

ipyton
test.метод? - описание

.count("xx") - посчичать кол-во хх в строке
.find("xxx") - найти позицию строки xxx

.startswith.("Fast") - начинается ли строка с Fast
.endswith.("0/1") - заканчивается ли строка на 0/1

.replace("старое значение", "новое значение")
.strip() - удаление пробельных символов из начала и конца строки
.strip("[]") - удаление символов [ и ] из начала и конца строки

.split() - разделение строки по пробельным символам
.split("xx") - разделение строки по символам xx
```

#### Списки (List)

список - **изменяемый** упорядоченный тип данных
задается в [] через запятую
можно обращаться по индексу []

`vlans2 = vlans` - создать ссылку на список (т.к. тип - изменяемый); `id(vlans)` будет равен `id(vlans2)`
`vlans + vlans2` - объединить список

* Срезы

```python
vlans = [1, 10, 30, 100, 5, 15]
vlans[0] - элемент 0 = 1
vlans[2:5] - с 
vlans[2:5:2] - с шагом 2
```

* Список списков

```pyton
interfaces = [
    ["Fa0/1", "192.168.1.1"],
    ["Fa0/2", "192.168.1.2"],
    ["Fa0/3", "192.168.1.3"],
]

interfaces[0][1]
Fa0/1
```

* Функции
  `len(список)` - количество элементов
  `sorted(список)` - упорядочить (всегда возвращает список)
  `del interfaces[2]` - удалить элемент 2
  `id(объект)` - идентификатор

* Методы
  `.sort()` - отсортировать
  `";".join(["a", "b", "c"])` - объединить = a;b;c
  `.copy()` - сделать копию списка
  `.append(хх)` - добавить один элемент в конец списка
  `.extend(список)` - добавить несколько элементов в конец списка
  `.remove("хх")` - удалить первый элемент "хх" из списка
  `.insert(1, "xx")` - вставить новый элемент "xx" в позицию 1

#### Словари (Dict)

Словарь (dict) - изменяемый тип данных
Упорядоченный тип данных, как записали, так и хранится (начиная с версии 3.7)
Все данные хранятся в виде пар ключ:значение

{ключ1: значение, ключ2: значение}
`name in london` - есть ли ключ в словаре
промежуточные переменные делают ссылку
`london2 = london` - создание ссылки на словарь
`london['key']` - получить значение по ключу key
`london['new_key'] = "dddd"` - добавление новой пары ключ/значение

* Методы словарей (dict)
  `.keys()` - объект view, список ключей
  `.values()` - объект view, список значений
  `.items()` - объект view, список пар ключ/значение
  объекты view можно преобразовывать в список list()
  `.copy()` - создать копию
  `.clear()` - очистить, можно `london = {}`
  `.get("key", "что возвращать, если ключа нет")` - получить значение по ключу или None, если ключа нет
  `.setdefault(ios, "значение")` - если ключ есть, то возвращает значение, если ключа нет, то создается новый ключ с пустым значением или со значением второго параметра
  `update({key1:a, key2:b})` - добавить и обновить пары
  `london_co[sw2] = dict.fromkeys(list(london_co['sw1'].keys()))` - создать новый словарь sw2 с пустыми значениями
  `dict.fromkeys(sw2, "xxx")` - создать новый словарь sw2 со значениями xxx

#### Кортежи (Tuple)

Кортежи (Tuple) - неизменяемый тип данных
Это список с правами только на чтение
Удобно получать из внешних источников, чтобы случайно не изменить

`list(кортеж)` - конвертация в список

* Методы
  `.count`
  `.index`

#### Множества (Set)

Множества (Set) - изменяемый неупорядоченный тип данных
содержит только уникальные значения
отображается как {x, y, z}
`set(список)` - конвертация списка в множество

* Методы
  `.add()` - добавить элемент
  `.discard()` - удалить элемент
  `.clear()` - очистить
  операции с множествами:
  `.intersection() или &` - найти пересечение множеств
  `.union() или |` - найти объединение множеств
  `.difference()` - найти отличие множеств
  `.symmetric_difference` - найти уникальные значения из множеств
  `issubset()`
  `issuperset()`
  
#### Булевы значения

* True
  число, строка или непустой объект
* False
  None, 0, пустой объект - это False

`bool(объект)` - возвращает True/False

#### Преобразование типов

'type(объект)' - выводит тип объекта
'type(vlans) = set' - проверка типа (True/False)

### CкриптЫ

#### Запуск

Первая строка скрипта должна быть
```bash
#!/usr/bin/env python3
```

chmod +x имя_скрипта.py

#### Аргументы

`from sys import argv` - импортируем модуль
`argv` - список (List), содержащий аргумены, переданные скрипту
`argv[0]` - имя скрипта
`argv[1..n]` - параметры

### Условия

```pyton
if/elif/else
```
* Синтаксис

```pyton
if a == b:
    pass
elif a > b:
    pass
else:
    pass
```

## Pytest

Pytest - средство для автоматизированного тестирования кода

`pytest test\exercise_n_1.py` - вызов теста exercise_n_1.py
запускать из каталога n_exercise

Настройка pytest под Windows 10

```bash
pip install pytest
pip install pyyaml
```

## Регулярные выражения

[шпаргалка по регулярным выражениям - pythex.org](www.pythex.org)
[шпаргалка по регулярным выражениям - pyregex.org](pyregex.org)

`import re` - импортируем станд модуль Python
`m = re.search(regex, line)`
`m == None`, если нет совпадения

`m.group()` - возвращает строку, совпавшую с regex
`m.group(1)` - возвращает первую группу
`m.group(3, 1, 2)` - возвращает строку с определенной последовательностью групп
`m.groups()` - возвращает кортеж из всех групп

Нужно использовать raw строки
`r"регулярное выражение \w \w"` - не требует экранирования каждого спецсимвола

### Спецсимволы

`\d` - все цифры
`\D` - все символы, кроме цифр
`\w` - все цифры и буквы
`\W` - все символы, кроме цифр и букв
`\s` - все пробельные символы
`\S` - все символы, кроме пробельных

`regex+` - 1 и более совпадений
`regex*` - 0 или более совпадений
`regex?` - 0 или 1 повторение предыдущего символа
`regex{n}` - повторение совпадения n раз

`\.` - любой символ (кроме перевода строки)
`^` - начало строки
`$` - конец строки
`[abc]` - любоЙ симол из указанных в скобках
`[^abc]` - любоЙ симол, кроме указанных в скобках
`[^abc]` - любоЙ симол, кроме указанных в скобках
`a|b` - выражение a или выражение b
`0/0|0/1` - 0/0 или 0/1
`()` - группировка символов

### Жадность спецсимволов повторения

По умолчанию спецсимволы повторения
`+`, `*` захватывают совпадение максимальной длины
`+?`, `*?` захватывают совпадение минимальной длины

### Группы

Все, что в скобках попадает в группы: `m = re.search("...regex...(xxx)...regex...", line)`
Запоминается последнее совпадение с группой
`m.group(0)` - все совпадение
`m.group(1)` - первая группа
`m.group(n)` - n-ная группа

**Именованные группы**
`(?P<name>regex)` - Именованная группа name
`m.group(name)` - группа name
`m.groupdict()` - словарь именованных групп

`(:?regex)` - Группа без захвата.

### Функции модуля re

`.start()` - индекс начала совпадения
`.end()` - индекс конца совпадения
`.span()` - возвращает кортеж (начало, конец)

* .search(regex, line)

`m = re.search('regex', line)` - поиск рег.выражения regex в строке line. Обрабатывает построчно, возвращает первое совпадение
`m.lastgroup` - переменная, содержит имя последней найденной группы
`m.lastindex` - переменная, содержит номер последней найденной группы
`m = re.search(r'(/d+) /1)', line)` - поиск группы цифр, а потом еще раз такое же число

* .findall(regex, line)

Ищутся все повторения
если нет групп - возвращает список строк
? если 1 группа - возвращает список кортежей
если несколько  группа - возвращает список кортежей

* .finditer(regex, line)

это итератор, по отдает по одному совпадению в цикле. Поддерживает все функции .search (.group() и т.д.)

```bash
result = re.finditer(regex, line)
for match in result:
    pass
```

* .compile()

функция compile заранее компилирует регулярное выражение для дальнейшего использования в коде. Плюс есть еще несколько функций:

* .split() - разбиение на подстроки

* .sub() - замена

`m = re.sub('regex', line)` - поиск замена по регулярному выражению 

### Флаги

флаги изменяют поведение регулярных выражений
несколько флагов передают через | 
"re.DOTALL | re.IGNORECASE"

`re.DOTALL` - режим мультилайн (`.+` и `.*` работают до конца файла, а не до конца строки)
`re.` - режим 
`re.` - режим 
`re.` - режим 